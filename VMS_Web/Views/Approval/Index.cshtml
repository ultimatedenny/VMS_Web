
@{
    ViewBag.Title = "Approval";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@Scripts.Render("~/Mousetrap")
@Scripts.Render("~/Webcam")
@Styles.Render("~/DataTablesCS")
@Scripts.Render("~/DataTablesJS")

<style scoped>
   

    .k-textboxlarge {
        height: 40px;
        width: 100%;
        font-size: 20px;
    }
</style>
<script>
    
    function showMyTask() {
        $('#rowMyTask').show();
        var table = $("#myTaskGrid").DataTable({
            destroy: true,
            "scrollX": true,
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": false, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,
            "ajax": {
                "url": "@Url.Action("ShowRequestApproval", "Approval")",
                "type": "POST",
                "datatype": "json",
                //"data": function (d) {
                //    return $.extend({}, d, {
                //        "Name": Name
                //    });
                //}
             },

                "columnDefs":
                [{
                    "targets": [0],
                    "visible": false,
                    "searchable": false
                },
                {
                    "targets": [11],
                    "searchable": false,
                    "orderable": false
                }],

    "columns": [

        { "data": "LogId", "name": "LogId", "autoWidth": true },
        {
            "data": "No",
            render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
            }
        },
        {
            "render": function (data, type, full, meta) {
                return '<button class="btn btn-info"  onclick="ApproveVisitor(' + full.LogId + ')"><i class="fa fa-1x fa-check-circle"></i> Approve</button> - <button class="btn btn-danger"  onclick="RejectVisitor(' + full.LogId + ')"><i class="fa fa-1x fa-times-circle"></i> Reject</button>';
            }
        },
        { "data": "Area", "name": "Area", "title": "Area", "autoWidth": true },
        { "data": "HostName", "name": "HostName", "title": "Host Name", "autoWidth": true },
        { "data": "FullName", "name": "FullName", "title": "Visitor Name", "autoWidth": true },
        { "data": "Remark", "name": "Remark", "title": "Remark", "autoWidth": true },
        { "data": "DateStart", "name": "DateStart", "title": "Date Start", "autoWidth": true },
        { "data": "DateEnd", "name": "DateEnd", "title": "Date End", "autoWidth": true },
        { "data": "TimeStart", "name": "TimeStart", "title": "Time Start", "autoWidth": true },
        { "data": "TimeEnd", "name": "TimeEnd", "title": "Time End", "autoWidth": true },
        { "data": "Status", "name": "Status", "title": "Status", "autoWidth": true },
        

    ]
    }
        );
        
    }
    
</script>
<script>

    function showMyHistoryTask() {
        $('#myHistoryGrid').show("slow");
        var table = $("#myHistoryGrid").DataTable({
            destroy: true,
            "scrollX": true,
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": false, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "pageLength": 10,
            "ajax": {
                "url": "@Url.Action("ShowHistoryApproval", "Approval")",
                "type": "POST",
                "datatype": "json",
                //"data": function (d) {
                //    return $.extend({}, d, {
                //        "Name": Name
                //    });
                //}
             },

                "columnDefs":
                [{
                    "targets": [0],
                    "visible": true,
                    "searchable": false
                },
                {
                    "targets": [1],
                    "searchable": false,
                    "orderable": false
                }],

    "columns": [

        {
            "data": "No",
            render: function (data, type, row, meta) {
                return meta.row + meta.settings._iDisplayStart + 1;
            }
        },
        { "data": "Area", "name": "Area", "title": "Area", "autoWidth": true },
        { "data": "HostName", "name": "HostName", "title": "Host Name", "autoWidth": true },
        { "data": "FullName", "name": "FullName", "title": "Visitor Name", "autoWidth": true },
        { "data": "Remark", "name": "Remark", "title": "Remark", "autoWidth": true },
        { "data": "DateStart", "name": "DateStart", "title": "Date Start", "autoWidth": true },
        { "data": "DateEnd", "name": "DateEnd", "title": "Date End", "autoWidth": true },
        { "data": "TimeStart", "name": "TimeStart", "title": "Time Start", "autoWidth": true },
        { "data": "TimeEnd", "name": "TimeEnd", "title": "Time End", "autoWidth": true },
        { "data": "Status", "name": "Status", "title": "Status", "autoWidth": true },


    ]
    }
        );
    }
</script>
<div class="row" id="rowMyTask" hidden="hidden">
    <div class="col-md-12" id="BoxMyTask">
        <div class="box ShimanoBox">
            <div class="box-header">
                My Task
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="row">
                    <div class="col-md-12">
                        <div style="width:100%; margin:0 auto;">
                            <table id="myTaskGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>LogId</th>
                                        <th>No</th>
                                        <th>Action</th>
                                        <th>Area</th>
                                        <th>Host Name</th>
                                        <th>Visitor Name</th>
                                        <th>Remark</th>
                                        <th>DateStart</th>
                                        <th>DateEnd</th>
                                        <th>TimeStart</th>
                                        <th>TimeEnd</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box-body -->

        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" id="boxHistoryTask">
        <div class="box ShimanoBox">
            <div class="box-header">
                History My Task
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                            title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <div class="row" id="RowHistoryTask">
                    <div class="col-md-12">
                        <div style="width:100%; margin:0 auto;">
                            <table id="myHistoryGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>Area</th>
                                        <th>Host Name</th>
                                        <th>Visitor Name</th>
                                        <th>Remark</th>
                                        <th>DateStart</th>
                                        <th>DateEnd</th>
                                        <th>TimeStart</th>
                                        <th>TimeEnd</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.box-body -->

        </div>
    </div>
</div>


<div class="modal fade" id="modalApprovalAction" hidden="hidden">
    <div class="modal-dialog ">
        <div class="modal-content ShimanoBlackBox">
            <div class="modal-header">
                <a href="#" style="color:white" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title" id="modalApprovalTitle">Reject Or Accept</h3>
            </div>
            <div class="modal-body" id="myModalBodyDiv1">
                <div class="row">
                    <div class="col-md-12">
                    @Html.Hidden("LogId")
                    @Html.Hidden("Status")
                        <p id="modalApprovalBody">Are you Sure to Accept this Request?</p>
                    </div>
                </div>
                <div class="row" id="rowRemark" hidden="hidden">
                    <div class="col-md-12">
                        <div class="form-group">
                            @Html.Label("Remark", "Remark: ")<br />
                            @Html.TextArea("Remark","Accept", 3, 3, new { @class = "k-textbox", style = "width: 100%; padding:10px", required = "required" })
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-info" onclick="ApprovalActionAjax()" id="btnConfirm"><i class="fa fa-check"></i> Accept</button>
                <a href="#" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Close</a>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
        checkAuthorize();
        
    })
</script>
<script>
    function ApproveVisitor(LogId) {
        $('#modalApprovalAction').modal('show');
        $('#modalApprovalTitle').text('Accept');
        $('#modalApprovalBody').text('Are you Sure to Approve this Request Approval?');
        //
        $('#LogId').val(LogId);
        $('#Status').val('APPROVED');
        $('#Remark').val("APPROVED");
        $('#rowRemark').hide("");
    }
</script>
<script>
    function RejectVisitor(LogId) {
        $('#modalApprovalAction').modal('show');
        $('#modalApprovalTitle').text('Reject');
        $('#modalApprovalBody').text('Are you Sure to Reject this Request Approval?');
        //
        $('#LogId').val(LogId);
        $('#Status').val('REJECTED');
        $('#Remark').val("");
        $('#rowRemark').show("slow");
    }
</script>
<script id="AJAX">
    $(function () {
        $('#chkDelegate').change(function () {
            var isDelegate = $(this).prop('checked');
            $.ajax({
                url: '@Url.Action("ChangeDelegate", "Approval")',
                cache: false,
                type: "POST",
                data: { isDelegate: isDelegate },
                success: function (data) {

                },
                error: function () {
                    toastr.error("Something wrong with this, please call IT!", "ERROR!");
                }

            })
        })
    })
    function checkDelegate() {
        $.ajax({
            url: '@Url.Action("CheckDelegate", "Approval")',
            cache: false,
            type: "POST",
            success: function (data) {
                if (data.Success === true) {
                    $('#chkDelegate').bootstrapToggle('on')
                }
                else {
                    $('#chkDelegate').bootstrapToggle('off')
                }
            },
            error: function () {
                toastr.error("Something wrong with this, please call IT!", "ERROR!");
            }

        })
    }
    function checkAuthorize() {
        $.ajax({
            url: '@Url.Action("CheckAuthorize", "Approval")',
            cache: false,
            type: "POST", 
            success: function (data) {
                if (data.Success === true) {
                    toastr.success("You have Access Right to Approve", "Success!");
                    showMyTask();
                    showMyHistoryTask();
                    checkDelegate();
                }
                else {
                    toastr.warning("You dont have Access Right To Approve", "Warning!");
                }
            },
            error: function () {
                toastr.error("Something wrong with this, please call IT!", "ERROR!");
            }

        });
    }
    function ApprovalActionAjax() {
        var LogId = $("#LogId").val();
        var Status = $("#Status").val();
        var Remark = $("#Remark").val();
        $.ajax({
            url : '@Url.Action("ApprovalAction", "Approval")',
            cache: false,
            type: "POST",
            data: { LogId: LogId, Status: Status, Remark: Remark },
            success: function (data) {
                if (data.Success === true) {
                    toastr.success(data.message, "Success!");
                    $('#modalApprovalAction').modal('hide');
                    showMyTask();
                    showMyHistoryTask();
                }
                else {
                    $('#modalApprovalAction').modal('hide');
                    toastr.warning(data.message, "Warning!");
                    showMyTask();
                    showMyHistoryTask();
                }
            },
        });
    }
</script>


